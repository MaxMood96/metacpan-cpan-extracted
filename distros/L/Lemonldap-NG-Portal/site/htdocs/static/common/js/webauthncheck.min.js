!function(){"use strict";var t,n,r=function(e,t){return $("#msg").attr("trspan",e),$("#msg").html(window.translate(e)),$("#color").removeClass("message-positive message-warning message-danger alert-success alert-warning alert-danger"),$("#color").addClass("message-".concat(t)),"positive"===t&&(t="success"),$("#color").addClass("alert-".concat(t))},i=function(){var t,e;if(webauthnJSON.supported())return window.webauthnAbort&&(console.debug("Aborting conditional mediation"),window.webauthnAbort.abort()),t=jQuery.Event("webauthnAttempt"),$(document).trigger(t),t.isDefaultPrevented()?void 0:(r("webAuthnBrowserInProgress","warning"),e={publicKey:window.datas.request},webauthnJSON.get(e).then(function(e){if(t=jQuery.Event("webauthnSuccess"),$(document).trigger(t,[e]),!t.isDefaultPrevented())return $("#credential").val(JSON.stringify(e)),$("#credential").closest("form").submit()}).catch(function(e){return t=jQuery.Event("webauthnFailure"),$(document).trigger(t,[e]),t.isDefaultPrevented()||r("webAuthnBrowserFailed","danger"),n()}));r("webAuthnUnsupported","warning")};window.webauthn_start=i,n=function(){if(PublicKeyCredential.isConditionalMediationAvailable)return PublicKeyCredential.isConditionalMediationAvailable().then(function(e){if(e)return t()})},t=function(){var e;return console.debug("Setting up conditional mediation"),window.webauthnAbort=new AbortController,e={publicKey:window.datas.request,mediation:"conditional",signal:window.webauthnAbort.signal},webauthnJSON.get(e).then(function(e){var t=jQuery.Event("webauthnSuccess");if($(document).trigger(t,[e]),!t.isDefaultPrevented())return $("#credential").val(JSON.stringify(e)),$("#credential").closest("form").submit()}).catch(function(e){var t=jQuery.Event("webauthnFailure");if($(document).trigger(t,[e]),!t.isDefaultPrevented())return!0})},$(document).on("portalLoaded",{},function(e,t){return $(document).ready(function(){if($("#retrybutton").on("click",i),$(".webauthnclick").on("click",i),n(),window.datas.webauthn_autostart)return setTimeout(i,1e3)})})}();