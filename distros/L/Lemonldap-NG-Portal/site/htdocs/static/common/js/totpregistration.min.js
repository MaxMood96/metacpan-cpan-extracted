!function(){"use strict";var o=function(e,r){return $("#msg").attr("trspan",e),$("#msg").html(window.translate(e)),$("#color").removeClass("message-positive message-warning message-danger alert-success alert-warning alert-danger"),$("#color").addClass("message-".concat(r)),"positive"===r&&(r="success"),$("#color").addClass("alert-".concat(r)),$("#msg").attr("role","danger"===r?"alert":"status")},r=function(e,r,t){if(console.error("Error",t),(t=JSON.parse(e.responseText))&&t.error)return t=t.error.replace(/.* /,""),console.error("Returned error",t),o(t,"warning")},a="",e=function(){return o("yourTotpKey","warning"),$.ajax({type:"POST",url:"".concat(scriptname,"2fregisters/totp/getkey"),dataType:"json",headers:{"X-CSRF-Check":"1"},error:r,success:function(e){var r,t;return e.error?o(e.error,"warning"):e.portal&&e.user&&e.secret?($("#divToHide").show(),r="otpauth://totp/".concat(escape(e.portal),":").concat(escape(e.user),"?secret=").concat(e.secret,"&issuer=").concat(escape(e.portal)),6!==e.digits&&(r+="&digits=".concat(e.digits)),30!==e.interval&&(r+="&period=".concat(e.interval)),new QRious({element:document.getElementById("qr"),value:r,size:150}),t=e.secret||"",$(".otpauth-url").attr("href",r),$("#secret").text(t.toUpperCase().replace(/(.{4})/g,"$1 ").trim()),e.newkey?o("yourNewTotpKey","warning"):o("yourTotpKey","success"),a=e.token):o("PE24","danger")}})},t=function(){var e=$("#code").val();return e?$.ajax({type:"POST",url:"".concat(scriptname,"2fregisters/totp/verify"),dataType:"json",data:{token:a,code:e,TOTPName:$("#TOTPName").val()},headers:{"X-CSRF-Check":"1"},error:r,success:function(e){return e.error?e.error.match(/bad(Code|Name)/)?o(e.error,"warning"):o(e.error,"danger"):(e=jQuery.Event("mfaAdded"),$(document).trigger(e,[{type:"totp"}]),e.isDefaultPrevented()?void 0:window.location.href=window.portal+"2fregisters?continue=1")}}):(o("totpMissingCode","warning"),$("#code").focus())};$(document).ready(function(){return e(),$("#verify").on("click",t)})}();