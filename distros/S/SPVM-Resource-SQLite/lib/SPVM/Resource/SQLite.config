# Copyright (c) 2026 Yuki Kimoto
# MIT License

use strict;
use warnings;
use SPVM::Builder::Config;

# Using c9 for better portability and modern C features
my $config = SPVM::Builder::Config->new_c99;

$config->is_resource(1);

# SQLite Standard Optimization and Portability Flags
# These flags cover almost all features provided by Perl's DBD::SQLite.
$config->add_ccflag(
  '-DSQLITE_THREADSAFE=1',
  '-DSQLITE_ENABLE_COLUMN_METADATA',
  '-DSQLITE_ENABLE_FTS5',
  '-DSQLITE_ENABLE_RTREE',
  '-DSQLITE_ENABLE_MATH_FUNCTIONS',
  '-DSQLITE_ENABLE_JSON1',
  '-DSQLITE_ENABLE_DBSTAT_VTAB',
  '-pthread',
);

# Unix-like systems require pthread for thread-safe SQLite
unless ($^O eq 'MSWin32') {
  $config->add_ccflag('-pthread');
  $config->add_ldflag('-pthread');
}

# SQLite Amalgamation is a single C source file
$config->add_source_file('sqlite3.c');

$config;
